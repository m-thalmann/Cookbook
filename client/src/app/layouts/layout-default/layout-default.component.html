<ng-container
    *ngIf="{
        user: auth.user$ | async,
        isAuthenticated: auth.isAuthenticated$ | async,
        isOverlayRoute: isOverlayRoute$ | async,
        showAddButton: showAddButton$ | async
    } as vm"
>
    <div class="desktop-spacer left"></div>

    <div class="container" [class.is-overlay]="vm.isOverlayRoute">
        <div>
            <header [class.hide-mobile]="vm.isOverlayRoute">
                <img src="/assets/images/cookbook.svg" alt="Cookbook Logo" />
                <h1>Cookbook</h1>

                <div class="spacer"></div>

                <ng-container *ngIf="vm.isAuthenticated; else loginButton">
                    <button mat-icon-button [matMenuTriggerFor]="accountMenue" color="primary">
                        <mat-icon>manage_accounts</mat-icon>
                    </button>
                </ng-container>
                <ng-template #loginButton>
                    <a mat-icon-button routerLink="/login" [queryParams]="loginQueryParams" color="primary">
                        <mat-icon>login</mat-icon>
                    </a>
                </ng-template>
            </header>

            <main [class.has-add-button]="vm.showAddButton">
                <router-outlet></router-outlet>
            </main>
        </div>
    </div>

    <div class="desktop-spacer right"></div>

    <app-layout-add-action-fab *ngIf="vm.showAddButton"></app-layout-add-action-fab>

    <app-layout-default-navbar [class.hide-mobile]="vm.isOverlayRoute"></app-layout-default-navbar>

    <mat-menu #accountMenue="matMenu" xPosition="before">
        <div mat-menu-item disabled>
            <mat-icon>account_circle</mat-icon>
            <div matListItemTitle>{{ vm.user?.name }}</div>
            <div matListItemLine>{{ vm.user?.email }}</div>
        </div>

        <a mat-menu-item routerLink="/settings/account">
            <mat-icon>settings</mat-icon>
            <div matListItemTitle>Account settings</div>
        </a>

        <a mat-menu-item routerLink="/admin" *ngIf="vm.user?.is_admin">
            <mat-icon>admin_panel_settings</mat-icon>
            <div matListItemTitle>Admin area</div>
        </a>

        <a mat-menu-item routerLink="/recipes/trash">
            <mat-icon>delete</mat-icon>
            <div matListItemTitle>View trash</div>
        </a>

        <a mat-menu-item class="logout-button" (click)="doLogout()">
            <mat-icon color="warn">logout</mat-icon>
            <div matListItemTitle class="fg-warn">Logout</div>
        </a>
    </mat-menu>
</ng-container>
