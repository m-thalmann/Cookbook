@use 'sass:map';
@use '@angular/material' as mat;
@use 'theme/variables' as *;

@mixin apply() {
  @each $theme, $variables in $themes {
    $app-theme: map.get($variables, 'theme');

    $additional-variables: (
      'primary': mat.get-color-from-palette(map.get($variables, 'primary-palette')),
      'accent': mat.get-color-from-palette(map.get($variables, 'accent-palette')),
      'warn': mat.get-color-from-palette(map.get($variables, 'warn-palette')),
      'background': mat.get-color-from-palette(map.get($app-theme, 'background'), 'background'),
      'foreground': mat.get-color-from-palette(map.get($app-theme, 'foreground'), 'text'),
    );

    $variables: map.merge($variables, $additional-variables);

    @if ($theme == $default-theme) {
      :host-context(html:not([class^='theme-'])) &,
      :host-context(html.theme-#{$theme}) & {
        @content ($variables);
      }
    } @else {
      :host-context(html.theme-#{$theme}) & {
        @content ($variables);
      }
    }
  }
}
